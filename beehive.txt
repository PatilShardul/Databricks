
*** create a query.hql file in  hive ssh session ***

create database if not exists covidDB;                                                                                  
CREATE EXTERNAL TABLE if not exists covidDB.country_wise
(
        country string,
        confirmed int,
        deaths_per_hundred_cases float,
        recoverd_per_hundred_cases float,
        deaths_per_hundred_recovered float
)
ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' lines terminated by '\n'
STORED AS TEXTFILE LOCATION '/covid/hive/tables/' TBLPROPERTIES("skip.header.line.count"="1");

*** execute this command seperately to load the blob staorage file to hdfs ****
LOAD DATA INPATH 'wasbs://coviddatacontainer@coviddata2019.blob.core.windows.net/output' INTO TABLE covidDB.country_wise;

***to run the given file ***
beeline -u 'jdbc:hive2://headnodehost:10001/;transportMode=http' -i query.hql
****change database ***
!sql use coviddb;

**** Store output file to blob storage also same can be used for local hdfs storage ****

!sql Insert OverWrite 
Directory "wasbs://coviddatacontainer@coviddata2019.blob.core.windows.net/output/file.txt" 
ROW FORMAT DELIMITED FIELDS TERMINATED BY ','
stored as TEXTFILE  
select country,deaths_per_hundred_cases from country_wise
order by deaths_per_hundred_cases desc ;
