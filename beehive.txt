
*** create a query.hql file in  hive ssh session ***

create database if not exists covidDB;                                                                                  
CREATE EXTERNAL TABLE if not exists covidDB.country_wise
(
        country string,
        confirmed int,
        deaths_per_hundred_cases float,
        recoverd_per_hundred_cases float,
        deaths_per_hundred_recovered float
)
ROW FORMAT DELIMITED FIELDS TERMINATED BY ',' lines terminated by '\n'
STORED AS TEXTFILE LOCATION '/covid/hive/tables/' TBLPROPERTIES("skip.header.line.count"="1");

*** execute this command seperately to load the blob staorage file to hdfs ****
LOAD DATA INPATH 'wasbs://coviddatacontainer@coviddata2019.blob.core.windows.net/output' INTO TABLE covidDB.country_wise;

***to run the given file ***
beeline -u 'jdbc:hive2://headnodehost:10001/;transportMode=http' -i query.hql
****change database ***
!sql use coviddb;

**** Store output file to blob storage also same can be used for local hdfs storage ****

!sql Insert OverWrite 
Directory "wasbs://coviddatacontainer@coviddata2019.blob.core.windows.net/output/file.txt" 
ROW FORMAT DELIMITED FIELDS TERMINATED BY ','
stored as TEXTFILE  
select country,deaths_per_hundred_cases from country_wise
order by deaths_per_hundred_cases desc ;



**** Links for reference ***
https://docs.databricks.com/data/data-sources/azure/azure-storage.html#language-python
https://www.youtube.com/watch?v=5FX4vMvduEg&list=PLY-V_O-O7h4czJkAGTM9n1_HmJ3XD1MEO&index=5
https://medium.com/@zifah/how-to-write-data-from-an-azure-databricks-notebook-to-an-azure-blob-storage-container-283bfdf23893
https://docs.microsoft.com/en-us/answers/questions/35165/databricks-cluster-does-not-work-with-free-trial-s.html
https://towardsdatascience.com/introduction-to-data-preprocessing-in-machine-learning-a9fa83a5dc9d
https://docs.databricks.com/spark/latest/structured-streaming/demo-notebooks.html#demo-python
https://docs.databricks.com/spark/latest/dataframes-datasets/introduction-to-dataframes-python.html
https://docs.databricks.com/spark/latest/spark-sql/spark-pandas.html
https://docs.databricks.com/spark/latest/spark-sql/udf-python-pandas.html
https://docs.microsoft.com/en-us/learn/modules/perform-zero-etl-analytics-hdinsight-interactive-query/
https://www.kaggle.com/imdevskp/corona-virus-report
https://www.kaggle.com/imdevskp/corona-virus-report/notebooks
https://forums.databricks.com/questions/12391/pandasread-csv.html
https://docs.databricks.com/data/data.html
https://www.kaggle.com/imdevskp/corona-virus-report?select=usa_county_wise.csv
https://docs.databricks.com/data/data-sources/azure/azure-storage.html
https://hortonworks.com/wp-content/uploads/2013/05/hql_cheat_sheet.pdf
https://docs.microsoft.com/en-us/azure/hdinsight/hadoop/apache-hadoop-use-hive-beeline
https://docs.microsoft.com/en-us/archive/blogs/azuredatalake/hdinsight-attach-additional-azure-storage-accounts-to-the-cluster
https://stackoverflow.com/questions/51437057/hive-external-tables-map-to-azure-blob-storage
